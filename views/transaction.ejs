<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title || 'FinTrack' %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="page-root">
  <div class="app-header">
    <div class="brand">
      <span>🏢 FinSolutions</span>
    </div>
    <div class="nav">
      <a href="/dashboard">Dashboard</a>
      <a href="/transactions" style="color: #1193d4; font-weight: 600;">Transactions</a>
      <a href="/budgets">Budgets</a>
      <a href="/reports">Reports</a>
    </div>
    <div class="avatar" style="background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23666"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>');"></div>
  </div>

  <div class="container">
    <div class="content">
      <h1 class="page-title">Transaction Management</h1>
      
      <div class="search">
        <div class="search-input">
          <span class="material-symbols-outlined">🔍</span>
          <input type="text" placeholder="Search transactions...">
        </div>
      </div>

      <div class="filters">
        <div class="filter-group">
          <button class="chip-btn">
            <span class="material-symbols-outlined">📅</span>
            Date Range
          </button>
          <button class="chip-btn">
            <span class="material-symbols-outlined">📂</span>
            Category
          </button>
          <button class="chip-btn">
            <span class="material-symbols-outlined">🔄</span>
            Type
          </button>
        </div>
        <button class="primary-btn" onclick="openAddModal()">
          <span class="material-symbols-outlined">➕</span>
          Add New Transaction
        </button>
      </div>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Category</th>
              <th>User</th>
              <th>Amount</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% transactions.forEach(transaction => { %>
            <tr>
              <td><%= new Date(transaction.date).toLocaleDateString() %></td>
              <td><%= transaction.categorie ? transaction.categorie.name : 'Uncategorized' %></td>
              <td><%= transaction.categorie && transaction.categorie.user ? `${transaction.categorie.user.firstName} ${transaction.categorie.user.lastName}` : 'No User' %></td>
              <td class="<%= transaction.type === 'revenu' ? 'amount-pos' : 'amount-neg' %>">
                <%= transaction.type === 'revenu' ? '+' : '-' %>DH<%= transaction.montant.toLocaleString() %>
              </td>
              <td class="<%= transaction.type === 'revenu' ? 'type-pos' : 'type-neg' %>">
                <%= transaction.type === 'revenu' ? 'Income' : 'Expense' %>
              </td>
              <td>
                <div class="row-actions">
                  <button class="icon-btn" onclick="editTransaction(<%= transaction.id %>)">
                    <span class="material-symbols-outlined">✏️</span>
                  </button>
                  <button class="icon-btn delete" onclick="deleteTransaction(<%= transaction.id %>)">
                    <span class="material-symbols-outlined">🗑️</span>
                  </button>
                </div>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Transaction Modal -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <h3>Add New Transaction</h3>
    <form id="transactionForm">
      <input type="text" name="description" placeholder="Description" required>
      <input type="number" name="amount" placeholder="Amount" step="0.01" required>
      <select name="type">
        <option value="">Select Type</option>
        <option value="revenu">Revenue</option>
        <option value="depense">Expense</option>
      </select>
      <select name="categoryId">
        <option value="">Select Category</option>
        <% categories.forEach(cat => { %>
        <option value="<%= cat.id %>"><%= cat.name %></option>
        <% }); %>
      </select>
      <input type="date" name="date" required>
      <div class="modal-actions">
        <button type="button" onclick="closeModal()">Cancel</button>
        <button type="submit">Add Transaction</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Transaction Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3>Edit Transaction</h3>
    <form id="editForm">
      <input type="hidden" id="editId">
      <input type="text" id="editDescription" placeholder="Description" required>
      <input type="number" id="editAmount" placeholder="Amount" step="0.01" required>
      <select id="editType">
        <option value="">Select Type</option>
        <option value="revenu">Revenue</option>
        <option value="depense">Expense</option>
      </select>
      <select id="editCategory">
        <option value="">Select Category</option>
        <% categories.forEach(cat => { %>
        <option value="<%= cat.id %>"><%= cat.name %></option>
        <% }); %>
      </select>
      <input type="date" id="editDate" required>
      <div class="modal-actions">
        <button type="button" onclick="closeEditModal()">Cancel</button>
        <button type="submit">Update</button>
      </div>
    </form>
  </div>
</div>

<script src="/js/transactions.js"></script>

</body>
</html>
